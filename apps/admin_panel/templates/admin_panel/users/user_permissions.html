{% extends "admin_panel/base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h3 class="card-title">Phân quyền người dùng: {{ user_obj.get_full_name|default:user_obj.username }}</h3>
    </div>
    <div class="card-body">
        <form method="post">
            {% csrf_token %}
            
            <div class="row">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title">Quyền hệ thống</h5>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <div class="custom-control custom-switch">
                                    <input type="checkbox" class="custom-control-input" id="is_active" name="is_active" {% if user_obj.is_active %}checked{% endif %}>
                                    <label class="custom-control-label" for="is_active">Kích hoạt tài khoản</label>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="custom-control custom-switch">
                                    <input type="checkbox" class="custom-control-input" id="is_staff" name="is_staff" {% if user_obj.is_staff %}checked{% endif %}>
                                    <label class="custom-control-label" for="is_staff">Nhân viên (có quyền truy cập khu vực quản trị)</label>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="custom-control custom-switch">
                                    <input type="checkbox" class="custom-control-input" id="is_superuser" name="is_superuser" {% if user_obj.is_superuser %}checked{% endif %}>
                                    <label class="custom-control-label" for="is_superuser">Quản trị viên (toàn quyền)</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title">Vai trò người dùng</h5>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle"></i> Người dùng chỉ có thể có một vai trò duy nhất.
                            </div>
                            <div class="form-group">
                                <div class="custom-control custom-radio">
                                    <input type="radio" class="custom-control-input" id="role_none" name="role" value="" {% if not user_obj.is_branch_manager and not user_obj.is_sales_staff and not user_obj.is_inventory_staff %}checked{% endif %}>
                                    <label class="custom-control-label" for="role_none">Khách hàng (không có vai trò đặc biệt)</label>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="custom-control custom-radio">
                                    <input type="radio" class="custom-control-input" id="role_branch_manager" name="role" value="branch_manager" {% if user_obj.is_branch_manager %}checked{% endif %}>
                                    <label class="custom-control-label" for="role_branch_manager">Quản lý chi nhánh</label>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="custom-control custom-radio">
                                    <input type="radio" class="custom-control-input" id="role_sales_staff" name="role" value="sales_staff" {% if user_obj.is_sales_staff %}checked{% endif %}>
                                    <label class="custom-control-label" for="role_sales_staff">Nhân viên bán hàng</label>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="custom-control custom-radio">
                                    <input type="radio" class="custom-control-input" id="role_inventory_staff" name="role" value="inventory_staff" {% if user_obj.is_inventory_staff %}checked{% endif %}>
                                    <label class="custom-control-label" for="role_inventory_staff">Nhân viên kho</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="card-title">Nhóm quyền</h5>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label>Chọn nhóm quyền</label>
                        <select multiple class="form-control" name="groups" id="groups">
                            {% for group in groups %}
                            <option value="{{ group.id }}" {% if group in user_obj.groups.all %}selected{% endif %}>{{ group.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="form-group mt-4">
                <button type="submit" class="btn btn-primary">Lưu thay đổi</button>
                <a href="{% url 'admin_panel:user_detail' user_obj.id %}" class="btn btn-secondary">Quay lại</a>
            </div>
        </form>
    </div>
</div>
{% endblock %} 