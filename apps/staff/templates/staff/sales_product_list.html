{% extends "base.html" %}
{% load static %}

{% block title %}Danh sách sản phẩm{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <!-- Sidebar -->
        <nav id="sidebar" class="col-md-3 col-lg-2 d-md-block bg-light sidebar">
            <div class="position-sticky pt-3">
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'staff:sales_dashboard' %}">
                            <i class="fas fa-tachometer-alt"></i> Tổng quan
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'staff:sales_order_list' %}">
                            <i class="fas fa-shopping-cart"></i> Đơn hàng
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'staff:sales_customer_list' %}">
                            <i class="fas fa-users"></i> Khách hàng
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="{% url 'staff:sales_product_list' %}">
                            <i class="fas fa-box-open"></i> Sản phẩm
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'staff:sales_reports' %}">
                            <i class="fas fa-chart-bar"></i> Báo cáo
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'staff:sales_profile' %}">
                            <i class="fas fa-user"></i> Hồ sơ cá nhân
                        </a>
                    </li>
                </ul>
            </div>
        </nav>

        <!-- Main content -->
        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="h2">Danh mục sản phẩm</h1>
            </div>

            <!-- Filter and Search -->
            <div class="row mb-3">
                <div class="col-md-8">
                    <form method="get" class="d-flex">
                        <input type="text" name="search" class="form-control me-2" placeholder="Tìm kiếm sản phẩm..." value="{{ search_query }}">
                        <select name="category" class="form-select me-2" style="max-width: 200px;">
                            <option value="">-- Danh mục --</option>
                            {% for category in categories %}
                            <option value="{{ category.id }}" {% if category_filter == category.id %}selected{% endif %}>{{ category.name }}</option>
                            {% endfor %}
                        </select>
                        <button type="submit" class="btn btn-primary">Lọc</button>
                    </form>
                </div>
            </div>

            <!-- Product Cards -->
            <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-3">
                {% for product in products %}
                <div class="col">
                    <div class="card h-100">
                        <img src="{{ product.image.url|default:'static/img/placeholder-product.png' }}" class="card-img-top" alt="{{ product.name }}" style="height: 200px; object-fit: cover;">
                        <div class="card-body">
                            <h5 class="card-title">{{ product.name }}</h5>
                            <p class="card-text text-truncate">{{ product.description|striptags }}</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="text-primary fw-bold">{{ product.price|floatformat:0 }}đ</span>
                                <span class="badge bg-{{ product.in_stock|yesno:'success,danger' }}">
                                    {{ product.in_stock|yesno:'Còn hàng,Hết hàng' }}
                                </span>
                            </div>
                        </div>
                        <div class="card-footer d-flex justify-content-between">
                            <a href="{% url 'staff:sales_product_detail' product.id %}" class="btn btn-sm btn-info">
                                <i class="fas fa-eye"></i> Chi tiết
                            </a>
                            <button class="btn btn-sm btn-primary add-to-order" data-product-id="{{ product.id }}">
                                <i class="fas fa-plus"></i> Thêm vào đơn
                            </button>
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="col-12">
                    <div class="alert alert-info">
                        Không có sản phẩm nào được tìm thấy
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Pagination -->
            {% if products.paginator %}
            <nav aria-label="Page navigation" class="mt-4">
                <ul class="pagination justify-content-center">
                    {% if products.has_previous %}
                    <li class="page-item">
                        <a class="page-link" href="?page=1{% if search_query %}&search={{ search_query }}{% endif %}{% if category_filter %}&category={{ category_filter }}{% endif %}" aria-label="First">
                            <span aria-hidden="true">&laquo;&laquo;</span>
                        </a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" href="?page={{ products.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if category_filter %}&category={{ category_filter }}{% endif %}" aria-label="Previous">
                            <span aria-hidden="true">&laquo;</span>
                        </a>
                    </li>
                    {% endif %}

                    {% for num in products.paginator.page_range %}
                    {% if products.number == num %}
                    <li class="page-item active"><a class="page-link" href="#">{{ num }}</a></li>
                    {% elif num > products.number|add:'-3' and num < products.number|add:'3' %}
                    <li class="page-item"><a class="page-link" href="?page={{ num }}{% if search_query %}&search={{ search_query }}{% endif %}{% if category_filter %}&category={{ category_filter }}{% endif %}">{{ num }}</a></li>
                    {% endif %}
                    {% endfor %}

                    {% if products.has_next %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ products.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if category_filter %}&category={{ category_filter }}{% endif %}" aria-label="Next">
                            <span aria-hidden="true">&raquo;</span>
                        </a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" href="?page={{ products.paginator.num_pages }}{% if search_query %}&search={{ search_query }}{% endif %}{% if category_filter %}&category={{ category_filter }}{% endif %}" aria-label="Last">
                            <span aria-hidden="true">&raquo;&raquo;</span>
                        </a>
                    </li>
                    {% endif %}
                </ul>
            </nav>
            {% endif %}
        </main>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Functionality to add product to current order
    document.querySelectorAll('.add-to-order').forEach(button => {
        button.addEventListener('click', function() {
            const productId = this.getAttribute('data-product-id');
            // Implement add to order functionality here
            alert('Sản phẩm đã được thêm vào đơn hàng (chức năng đang phát triển)');
        });
    });
</script>
{% endblock %} 